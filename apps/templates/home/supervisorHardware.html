{% extends "layouts/base.html" %}

{% block title %} Supervisor de Hardware {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<style>
    .input-group-addon {
        color: #00f2c3;
        border-color: #00f2c3;
        border: none
    }

    .input-group-addon:focus {
        outline: 0 !important
    }
</style>
{% endblock stylesheets %}

{% block content %}

<div class="content">
    <div class="row"></div>
    {# <h1>Hello {{ firstname }}</h1> #}
    <form id="formGrafica">
        {% csrf_token %}

        {% for error in errors  %}
        <div class="alert alert-danger mb-4" role="alert">
            <strong>{{ error }}</strong>
        </div>
        {% endfor %}

        <div class="row">
            <div class="col-lg-6">
                <div class="mb-4">
                    <div class="form-group">
                        <label>Seleccione Plataforma IoT</label>
                        {{ form.platafromas}}
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="mb-4">
                    <div class="form-group">
                        <label>Seleccione grupo</label>
                        <select id="id_grupo" class="form-control selectpicker" data-live-search="true" data-style="btn-success">
                            <option selected disabled value="0">Seleccione</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-md-center">
            <div class="col-lg-4">
                <input type="button" value="Generar" class="form-control btn btn-success" id="form_btn">
            </div>
            <!-- <div class="col-lg-4">
                <input type="button" value="Descargar PDF" class="form-control btn btn-warning" id="pdf_btn">
            </div> -->
        </div>

    </form>
    <br>
    <div id="contenido">
    </div>
</div>

<style>
    #chart-graficaMulti {
        height: 500px;
    }

    .highcharts-figure,
    .highcharts-data-table table {
        min-width: 310px;
        max-width: 800px;
        margin: 1em auto;
    }

    .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
    }

    .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #555;
    }

    .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
    }

    .highcharts-data-table td,
    .highcharts-data-table th,
    .highcharts-data-table caption {
        padding: 0.5em;
    }

    .highcharts-data-table thead tr,
    .highcharts-data-table tr:nth-child(even) {
        background: #f8f8f8;
    }

    .highcharts-data-table tr:hover {
        background: #f1f7ff;
    }

    .highcharts-background {
        fill: #ffffff00;
    }
</style>
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
    var x = 'hola';
    var chart_chartBig1;
    var medida;
    var cantDivs = 0,
        contDivs = 1;
    var idsCharts = [];

    function getGrupos() {
        var plataformaId = $('#id_plataforma').val();

        $.ajax({
            type: "POST",
            url: "{% url 'get-grupos' %}",
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'id': plataformaId
            },
            success: function(data) {
                let html_data = '<option disabled value="0" selected>Seleccione</option>';
                data.datos.forEach(function(data) {
                    html_data += `<option value="${data[0]}">${data[1]}</option>`
                });
                $("#id_grupo").html(html_data);
                $("#id_grupo").selectpicker("refresh");
            }
        });
    }

    $(document).ready(function() {
        $(".graficas").hide()

        $("#id_plataforma").change(function() {
            getGrupos();

        });

        $("#form_btn").click(function() {
            var plataformaId = $('#id_plataforma').val();
            var grupoId = $('#id_grupo').val();
            $('.graficas').html('');

            $.ajax({
                type: "POST",
                url: "{% url 'get-dispositivos-grupos' %}",
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'id_plataforma': plataformaId,
                    'id_grupo': grupoId
                },
                success: function(data) {
                    if (data.datos == 0) {
                        general.showNotificationOwn('top', 'right', 'warning', 'Datos Incompletos o Sin Informacion', 'ERROR')
                        $("#contenido").hide();
                    } else {
                        $("#contenido").show();
                        var i = 1,
                            j = 1;
                        var html = '',
                            buttons = '';

                        data.datos.forEach(function(data) {
                            buttons += '<div class="col-md-3">' +
                                '<div class="alert ' + data[2] + '" style="' + data[3] + '" onclick="infoEstacion(' + data[0] + ')">' +
                                '<span><b>' + data[1] + '</b></span>' +
                                '</div>' +
                                '</div>';
                            i++;
                            if (j < 4) {
                                j++;
                            } else {
                                html += '<div class="row">' +
                                    buttons +
                                    '</div>'
                                j = 1;
                                buttons = '';
                            }

                        });

                        if (j <= 4) {
                            html += '<div class="row">' +
                                buttons +
                                '</div>'
                        }

                        $('#contenido').html('<div class="col-lg-12 ml-auto mr-auto">' + html + '</div>');
                    }
                }
            });
        });

    });
</script>

{% endblock javascripts %}